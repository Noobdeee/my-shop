
<!DOCTYPE html> 
<html>
<head>
  <link rel="icon" href="data:,">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> My Herabete  v: 9.36.00 </title>    <!-- SCROLL EFERT ON LOGIN PAGE ADDED now trying for login page scroller and text -->
  <script src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.8.11/dist/dotlottie-wc.js" type="module"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  
  <style> 
    body {
      margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f5f6fa;
    }

    html, body {
  margin: 0;
  padding: 0;
}

    header {
      background: #111;
      color: white;
      padding: 18px;
      text-align: center;
      font-size: 20px;
      font-weight: 600;
    }

    #adminBar {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #222;
      color: white;
      padding: 10px;
      text-align: center;
      z-index: 9999;
    }

    #adminBar button {
      margin-left: 10px;
      padding: 5px 12px;
      border: none;
      border-radius: 6px;
      background: red;
      color: white;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      padding: 20px;
      margin-top: 10px;
    }

    .card {
      background: white;
      border-radius: 14px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      overflow: hidden;
      cursor: pointer;
    }

    .card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      background: #eee;
    }

    .card.dragging {
  opacity: 0.6;
}


    .name {
      font-weight: 600;
      padding: 8px;
      text-align: center;
    }

    .info {
      padding: 12px;
      display: none;
    }

    .card.show .info {
      display: block;
    }

    .info input,
    .info textarea,
    .info button {
      width: 100%;
      margin-top: 6px;
      padding: 6px;
    }



    /* ===== THEME SWITCH ===== */

    .theme-panel {
  display: flex;
  align-items: center;
  gap: 10px;
}

#themeSelect {
  padding: 6px 12px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
} 

#customColor {
  width: 40px;
  height: 40px;
  border: none;
  cursor: pointer;
  border-radius: 50%;
  padding: 0;
}

    

.theme-switch {
  position: fixed;
  top: 80px;          /* move below admin bar */
  right: 20px;
  z-index: 10000;     /* higher than admin bar */
}


.theme-switch input {
  display: none;
}

.slider {
  width: 70px;
  height: 35px;
  background: #ddd;
  border-radius: 50px;
  position: relative;
  cursor: pointer;
  transition: background 0.4s ease;
  display: flex;
  align-items: center;
  padding: 0 5px;
}

.slider::before {
  content: "";
  position: absolute;
  width: 28px;
  height: 28px;
  background: white;
  border-radius: 50%;
  top: 3.5px;
  left: 4px;
  transition: transform 0.4s ease;
  box-shadow: 0 3px 8px rgba(0,0,0,0.2);
}

.icon {
  font-size: 14px;
  z-index: 2;
}

.sun {
  margin-left: auto;
}

input:checked + .slider {
  background: #222;
}

input:checked + .slider::before {
  transform: translateX(34px);
}
/* ===== NIGHT MODE FULL DARK ===== */

body {
  transition: background 0.4s ease, color 0.4s ease;
}

body.night {
  background: #0f172a !important;
  color: #ffffff !important;
}

/* Header */
body.night header {
  background: #020617 !important;
  color: #ffffff !important;
}

/* Admin bar */
body.night #adminBar {
  background: #111827 !important;
}

/* Login button */
body.night #loginBtn {
  background: #1e293b !important;
  color: white !important;
}

/* Cards */
body.night .card {
  background: #1e293b !important;
  color: #ffffff !important;
  box-shadow: 0 6px 18px rgba(0,0,0,0.6) !important;
}

/* Images */
body.night .card img {
  background: #0f172a !important;
}

/* Inputs & textarea */
body.night input,
body.night textarea {
  background: #0f172a !important;
  color: #ffffff !important;
  border: 1px solid #334155 !important;
}

/* Buttons */
body.night button {
  background: #334155 !important;
  color: #ffffff !important;
}
/* Modal overlay */
.theme-modal {
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10001;
}

/* Modal box */
.theme-modal-content {
  background: #fff;
  padding: 25px 30px;
  border-radius: 15px;
  width: 320px;
  text-align: center;
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
  display: flex;
  flex-direction: column;
  gap: 15px;
  animation: fadeIn 0.3s ease;
}

.theme-modal-content h3 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
}

/* Color picker + preview */
.color-picker-wrapper {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
}

#customColor {
  width: 60px;
  height: 60px;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  transition: transform 0.2s;
}

#customColor:hover {
  transform: scale(1.1);
}

#colorPreview {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: 2px solid #333;
  background: #ff0000;
}

/* Buttons */
.theme-buttons {
  display: flex;
  justify-content: space-between;
  gap: 10px;
}

.theme-buttons button {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: background 0.2s;
}

#saveCustomThemeBtn {
  background: #22c55e;
  color: white;
}

#saveCustomThemeBtn:hover {
  background: #16a34a;
}

#cancelCustomThemeBtn {
  background: #ef4444;
  color: white;
}

#cancelCustomThemeBtn:hover {
  background: #b91c1c;
}

/* Fade in */
@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.9);}
  to { opacity: 1; transform: scale(1);}
}

    
    

    
    

@keyframes spin {
  to { transform: rotate(360deg); }
}






    
#authLoading {
  position: fixed;
  inset: 0;
  background: rgb(0, 136, 0);
  z-index: 2147483647;

  display: flex;
  justify-content: center;
  align-items: flex-end;      /* pushes content downward */
  padding-bottom: 10vh;       /* distance from bottom */
}

/* Container holding logo + animation */
.loader-box {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 5px;                  /* space between logo & animation */
}

/* Normal logo size */
.shop-logo {
  width: 85%;
  max-width: 340px;
  height: auto;
  object-fit: contain;
  border-radius: 30px;
 
   align-items: flex-end;
}

/* Loading animation */
.loading-animation {
  width: 220px;   /* bigger */
  height: 220px;
}


.lux-google-btn {
  margin-top: 35px;
  width: 100%;
  padding: 14px 18px;

  border-radius: 50px;  /* fully rounded pill */
  border: 1px solid rgba(200,164,93,0.6);

  background: linear-gradient(135deg, #1c1c1c, #2a2a2a);
  color: #ffffff;

  font-family: 'Inter', sans-serif;
  font-weight: 600;
  font-size: 15px;
  letter-spacing: 0.6px;

  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;

  cursor: pointer;
  transition: all 0.3s ease;

  box-shadow: 0 6px 20px rgba(0,0,0,0.35);
}

@media (hover: hover) {
  .lux-google-btn:hover {
    transform: translateY(-2px);
    border-color: #c8a45d;
    box-shadow: 0 10px 30px rgba(200,164,93,0.3);
  }
}

.lux-google-btn:active {
  transform: scale(0.96);
}

.google-svg {
  width: 20px;
  height: 20px;
}

/* Mobile Optimization */
@media (max-width: 480px) {
  .lux-google-btn {
    font-size: 15px;
    padding: 14px 18px;
  }
}









    /* ===== LOGIN HERO UPGRADE ===== */

.login-hero {
  height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg,#397a37,#1c5129);
  color: white;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.hero-title {
  font-family: 'Playfair Display', serif;
  font-size: 22px;
  font-weight: 700;
  letter-spacing: 1px;
  text-align: center;
  color: white;

  background: rgba(11, 72, 14, 0.6);   /* CHANGE COLOR HERE */
  padding: 12px 20px;
  border-radius: 25px;
  display: inline-block;
}


.brand {
  background: linear-gradient(90deg,#22c55e,#38bdf8);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.hero-sub {
  margin-top: 15px;
  font-size: 18px;
  opacity: 0;
  transform: translateY(40px);
}


@media (max-width: 480px) {
  .hero-title {
    font-size: 20px;
  }
}







/* Scroll hint */
.scroll-indicator {
  position: absolute;
  bottom: 30px;
  width: 30px;
  height: 50px;
  border: 2px solid white;
  border-radius: 20px;
}

.scroll-indicator::after {
  content:"";
  position:absolute;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  width:6px;
  height:6px;
  background:white;
  border-radius:50%;
  animation: scrollAnim 1.5s infinite;
}

@keyframes scrollAnim {
  0% { opacity:0; transform:translate(-50%,0);}
  50% { opacity:1;}
  100% { opacity:0; transform:translate(-50%,15px);}
}






    /* ===== GLASS CARD ===== */
.glass-card {
  padding: 45px 35px;
  border-radius: 30px;
  background: rgb(91, 144, 34);
  backdrop-filter: blur(18px);
  -webkit-backdrop-filter: blur(18px);
  border: 1px solid rgba(219, 17, 17, 0.15);
  box-shadow: 0 20px 50px rgba(0,0,0,0.45);
  animation: floatCard 6s ease-in-out infinite;
  width: 70%;
  max-width: 360px;   /* smaller and balanced */
}



.login-tooltip {
  margin-bottom: 15px;
  background: #111;
  color: white;
  padding: 10px 18px;
  border-radius: 25px;
  font-size: 13px;
  display: none;
  transition: opacity 0.3s ease;
}

@keyframes pulseTip {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}


@keyframes floatCard {
  0% { transform: translateY(0px); }
  50% { transform: translateY(-12px); }
  100% { transform: translateY(0px); }
}



.google-pro-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;

  margin: 25px auto;
  width: 100%;              /* FULL width of container */
  max-width: 340px;         /* Prevent too wide */
  padding: 14px 20px;

  border-radius: 40px;
  border: 1px solid rgba(0,0,0,0.1);
  border-color: #1c5129;
  background: white;
  color: #333;
  font-weight: 600;
  font-size: 14px;

  white-space: nowrap;      /* Keep in one line */
  overflow: hidden;         /* Prevent text going outside */
  box-sizing: border-box;   /* Important */
}






/* ===== LOGIN OVERLAY ===== */

.login-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(6px);
  display: none;
  z-index: 9999;
}

.login-popup {
  position: absolute;
  background: white;
  color: black;
  padding: 14px 20px;
  border-radius: 16px;
  font-size: 14px;
  font-weight: 500;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  animation: fadeIn 0.3s ease;
}

.popup-arrow {
  position: absolute;
  bottom: -8px;
  left: 50%;
  transform: translateX(-50%);
  width: 16px;
  height: 16px;
  background: white;
  rotate: 45deg;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}




/* ===== LOGIN GUIDE ===== */

.login-guide {
  position: fixed;
  background: white;
  color: black;
  padding: 12px 18px;
  border-radius: 18px;
  font-size: 14px;
  font-weight: 500;
  box-shadow: 0 10px 25px rgba(0,0,0,0.25);
  display: none;
  z-index: 9999;
}

.guide-arrow {
  position: absolute;
  bottom: -8px;
  left: 50%;
  transform: translateX(-50%) rotate(45deg);
  width: 14px;
  height: 14px;
  background: white;
}



    
  </style>
</head>























  
<body>

   
  


  <div id="introSection" style="display:none;">


    <div style="height:200vh; position:relative;">

      <video
  id="scrollVideo"
  src="https://cdn.jsdelivr.net/gh/Noobdeee/my-shop@main/images/best_italian_tiles_for_flooring_marble_tiles_720P.mp4"
  muted
  playsinline
  preload="auto"
  style="
    position:sticky;
    top:0;
    width:100%;
    height:100vh;
    object-fit:cover;
  ">
</video>

      
</div>




    
<!-- LOGIN SECTION -->
<section id="loginSection" class="login-hero">
  


  

  <div class="glass-card">

    <h1 class="hero-title">
      <span id="typingText"></span>
    </h1>

    <p class="hero-sub">
      Premium Tiles & Marble Collection
    </p>

    


    <button id="loginBtn" class="google-pro-btn">
      <span class="google-icon-wrapper">
        <svg width="18" height="18" viewBox="0 0 48 48">
          <path fill="#EA4335" d="M24 9.5c3.6 0 6.8 1.2 9.4 3.5l7-7C36.4 2.3 30.6 0 24 0 14.7 0 6.7 5.4 2.7 13.3l8.3 6.4C13 13.4 18 9.5 24 9.5z"/>
          <path fill="#4285F4" d="M46.1 24.5c0-1.6-.1-3.1-.4-4.5H24v9h12.4c-.5 2.7-2 5-4.3 6.5l6.7 5.2c3.9-3.6 6.3-9 6.3-15.2z"/>
          <path fill="#FBBC05" d="M10.9 28.1c-1-2.7-1-5.5 0-8.2l-8.3-6.4C.9 17 0 20.4 0 24s.9 7 2.6 10.5l8.3-6.4z"/>
          <path fill="#34A853" d="M24 48c6.6 0 12.1-2.2 16.2-6l-6.7-5.2c-2 1.4-4.5 2.2-9.5 2.2-6 0-11-3.9-12.8-9.2l-8.3 6.4C6.7 42.6 14.7 48 24 48z"/>
        </svg>
      </span>
      <span>Continue with Google</span>
    </button>

  </div>

  <div class="scroll-indicator"></div>

</section>

    
</div>





  
  <div id="shopContent" style="display:none;">

    
<header>My Shop Heeraa-betee </header>

<div id="userSection" style="display:none;">
  <img id="userPhoto" width="35" height="35" style="border-radius:50%;">
  <span id="userName"></span>
  <button id="logoutBtn">Logout</button>
</div>



    





  
<div id="authLoading">

  <div class="loader-box">

    <img 
      src="https://github.com/Noobdeee/my-shop/blob/main/images/TilesPro.jpg?raw=true"
      class="shop-logo"
      alt="Tiles Pro and Marble">

    <dotlottie-wc 
      src="https://lottie.host/631ccc0b-6bcc-42e0-8cc5-4664874cfed9/8BU1X6vtgD.lottie"
      autoplay
      class="loading-animation">
    </dotlottie-wc>

  </div>

</div>






  


  






  


  
<div id="adminBar">
  Admin Mode: <b>ON</b>
  <button id="adminOffBtn">OFF</button>
  <button id="addProductBtn">‚ûï Add Product</button>
  <button id="saveOrderBtn">üíæ Save Order</button>

</div>

<button id="adminUnlockBtn" style="display:none;">üîê Open Admin</button>






  
  <div class="theme-panel">
  <select id="themeSelect">
    <option value="day">‚òÄ Day</option>
    <option value="night">üåô Night</option>
    <option value="custom">üé® Custom</option>
  </select>


    
</div>






<div id="customThemeModal" class="theme-modal" style="display:none;">
  <div class="theme-modal-content">
    <h3>Choose Your Custom Theme</h3>

    <div class="color-picker-wrapper">
     <input type="color" id="customColor">
<div id="colorPreview"></div>
    </div>

    <div class="theme-buttons">
      <button id="saveCustomThemeBtn">üíæ Save Theme</button>
      <button id="cancelCustomThemeBtn">‚ùå Cancel</button>
    </div>
  </div>
</div>



  
  

  
<div class="grid" id="productList"></div>
</div>





    
<script type="module">





  // ===== TYPING EFFECT =====
  document.addEventListener("DOMContentLoaded", () => {

  const text = "Tiles Pro & Marble";
  const typingElement = document.getElementById("typingText");

  let index = 0;

  function typeEffect() {
    if (index < text.length) {
      typingElement.textContent += text.charAt(index);
      index++;
      setTimeout(typeEffect, 60);
    }
  }

  typeEffect();

});

  











  // ===== HERO ENTRANCE ANIMATION =====

gsap.to(".hero-title", {
  opacity: 1,
  y: 0,
  duration: 1,
  ease: "power3.out"
});

gsap.to(".hero-sub", {
  opacity: 1,
  y: 0,
  duration: 1,
  delay: 0.3,
  ease: "power3.out"
});







  
  
function closeThemeModal() {
  document.getElementById("customThemeModal").style.display = "none";
}
  
document.getElementById("saveCustomThemeBtn").addEventListener("click", () => {
  const color = document.getElementById("customColor").value;

  document.body.classList.remove("night");

  document.body.style.background = color;

  // auto text color
  const r = parseInt(color.substr(1,2),16);
  const g = parseInt(color.substr(3,2),16);
  const b = parseInt(color.substr(5,2),16);
  const brightness = (r * 299 + g * 587 + b * 114) / 1000;
  document.body.style.color = brightness > 128 ? "#000" : "#fff";

  localStorage.setItem("theme", "custom");
  localStorage.setItem("customColor", color);

  closeThemeModal();
});












window.addEventListener("DOMContentLoaded", () => {
  const select = document.getElementById("themeSelect");
  const customModal = document.getElementById("customThemeModal");
  const colorInput = document.getElementById("customColor");
  const colorPreview = document.getElementById("colorPreview");

  const savedTheme = localStorage.getItem("theme");
  const savedColor = localStorage.getItem("customColor");

  // Apply saved theme silently
  if (savedTheme === "night") {
    document.body.classList.add("night");
    select.value = "night";
  } else if (savedTheme === "custom" && savedColor) {
    document.body.classList.remove("night");
    document.body.style.background = savedColor;

    const r = parseInt(savedColor.substr(1,2),16);
    const g = parseInt(savedColor.substr(3,2),16);
    const b = parseInt(savedColor.substr(5,2),16);
    const brightness = (r*299 + g*587 + b*114)/1000;
    document.body.style.color = brightness > 128 ? "#000" : "#fff";

    colorInput.value = savedColor;
    colorPreview.style.background = savedColor;

    select.value = "custom"; // dropdown shows custom
    // DO NOT open modal
  } else {
    select.value = "day";
  }

  // Change event
  select.addEventListener("change", () => {
    const theme = select.value;

    if (theme === "day") {
      document.body.classList.remove("night");
      document.body.style.background = "";
      document.body.style.color = "";
      localStorage.setItem("theme", "day");
    } else if (theme === "night") {
      document.body.classList.add("night");
      document.body.style.background = "";
      document.body.style.color = "";
      localStorage.setItem("theme", "night");
    } else if (theme === "custom") {

  const savedColor = localStorage.getItem("customColor");

  if (savedColor) {
    colorInput.value = savedColor;
    colorPreview.style.background = savedColor;
  }

  customModal.style.display = "flex";
}
  });

  // Color preview in real-time
  colorInput.addEventListener("input", () => {
    colorPreview.style.background = colorInput.value;
  });

  // Save custom theme
  document.getElementById("saveCustomThemeBtn").addEventListener("click", () => {
    const color = colorInput.value;

    const r = parseInt(color.substr(1,2),16);
    const g = parseInt(color.substr(3,2),16);
    const b = parseInt(color.substr(5,2),16);
    const brightness = (r*299 + g*587 + b*114)/1000;

    document.body.classList.remove("night");
    document.body.style.background = color;
    document.body.style.color = brightness > 128 ? "#000" : "#fff";

    localStorage.setItem("theme", "custom");
    localStorage.setItem("customColor", color);

    customModal.style.display = "none";
  });

  // Cancel button
  document.getElementById("cancelCustomThemeBtn").addEventListener("click", () => {
    customModal.style.display = "none";
  });
});


  

  

  

  

/* ================= FIREBASE ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getAuth,
  GoogleAuthProvider,
  signInWithPopup,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCV432JfpHR3abZJXPDthNvH2jDMGLRcrM",
  authDomain: "my-shop-app-dc042.firebaseapp.com",
  projectId: "my-shop-app-dc042",
  storageBucket: "my-shop-app-dc042.firebasestorage.app",
  messagingSenderId: "393287049357",
  appId: "1:393287049357:web:1460ddf82ddad440e2c2c4"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

/* ================= CONFIG ================= */
const ADMIN_UID = "mOP5jc6j28b8SIvXEyskqCtsQZG3";
const API_URL = "https://script.google.com/macros/s/AKfycbyxnxuEAgJCMA9y1y_GRkyYGg8TNbGsY3yAjRAipPVuGoocdA_XQnkIPQCbkrZOWmB5/exec";

/* ================= STATE ================= */
let adminUnlocked = false;
let products = [];
  let openCards = new Set();
let authReady = false;
let productsReady = false;

/* ================= AUTH ================= */
let loginInProgress = false;

function showLoginMessage(msg) {
  const msgDiv = document.getElementById("loginMessage");
  if (msgDiv) msgDiv.textContent = msg;
}



  function googleLogin() {
  // Removed loginInProgress guard
  showLoginMessage(""); // clear previous message

  signInWithPopup(auth, provider)
    .then(result => {
      showLoginMessage(""); // clear on success
      // Optional: use result.user here
    })
    .catch(err => {
      let msg = "";

      switch(err.code) {
        case "auth/cancelled-popup-request":
          msg = "Login was cancelled or blocked. Please click the button again.";
          break;
        case "auth/popup-blocked":
          msg = "Popup blocked! Allow popups in your browser and try again.";
          break;
        case "auth/popup-closed-by-user":
          msg = "You closed the login popup. Please try again.";
          break;
        default:
          msg = "Login failed. Please try again.";
      }

      showLoginMessage(msg);
      console.warn("Firebase login error:", err.code, err.message);
    });
}



  
  
function logoutUser() {
  signOut(auth);
}




  
  
onAuthStateChanged(auth, (user) => {

  adminUnlocked = false;
  document.getElementById("adminBar").style.display = "none";
  document.getElementById("adminUnlockBtn").style.display = "none";

  const intro = document.getElementById("introSection");
  const shop = document.getElementById("shopContent");

  if (user) {

    // ‚úÖ NEW (show shop, hide intro)
    if (intro) intro.style.display = "none";
    if (shop) shop.style.display = "block";

    document.getElementById("userSection").style.display = "flex";
    document.getElementById("loginBtn").style.display = "none";
    document.getElementById("userPhoto").src = user.photoURL;
    document.getElementById("userName").textContent = user.displayName;

    if (user.uid === ADMIN_UID) {
      document.getElementById("adminUnlockBtn").style.display = "block";
    }

    // üå∏ FORCE Pink Theme For YUSRA
    const firstName = user.displayName
      ? user.displayName.trim().split(" ")[0].toUpperCase()
      : "";

    if (firstName === "YUSRA") {
      const pink = "#ff69b4";

      localStorage.setItem("theme", "custom");
      localStorage.setItem("customColor", pink);

      document.body.classList.remove("night");
      document.body.style.background = pink;

      const r = parseInt(pink.substr(1,2),16);
      const g = parseInt(pink.substr(3,2),16);
      const b = parseInt(pink.substr(5,2),16);
      const brightness = (r*299 + g*587 + b*114)/1000;

      document.body.style.color = brightness > 128 ? "#000" : "#fff";
    }

  } else {

    // ‚úÖ NEW (show intro, hide shop)
    if (intro) intro.style.display = "block";
    if (shop) shop.style.display = "none";


    setTimeout(() => {
  ScrollTrigger.refresh();
  initScrollVideo();
}, 500);



    
    document.getElementById("userSection").style.display = "none";
    document.getElementById("loginBtn").style.display = "block";
  }

  authReady = true;
  checkAppReady();

});


  
  
  
  loadProducts();





  
function checkAppReady() {
  if (authReady && productsReady) {
    document.getElementById("authLoading").style.display = "none";
  }
}




  

  function saveOrder() {
  if (!requireAdmin()) return;

  const orderData = products.map((p, index) => ({
    row: p.row,
    id: p.id,
    newPosition: index + 1
  }));

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "reorder",
      order: orderData
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      alert("Order saved permanently ‚úÖ");
    } else {
      alert("Failed to save order ‚ùå");
    }
  })
  .catch(err => {
    console.error("Save order error:", err);
    alert("Error saving order");
  });
}



  

/* ================= ADMIN ================= */
async function unlockAdmin() {
  const user = auth.currentUser;
  if (!user || user.uid !== ADMIN_UID) return alert("Not authorized");

  const password = prompt("Enter Admin Password");
  if (!password) return;

  const res = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "login", password })
  });

  const data = await res.json();
  if (data.success) {
    adminUnlocked = true;
    document.getElementById("adminBar").style.display = "block";
    document.getElementById("adminUnlockBtn").style.display = "none";
    renderProducts();
  } else {
    alert("Wrong password");
  }
}

function logoutAdmin() {
  adminUnlocked = false;
  document.getElementById("adminBar").style.display = "none";
  document.getElementById("adminUnlockBtn").style.display = "block";
  renderProducts();
}

function requireAdmin() {
  if (!adminUnlocked) {
    alert("Unlock admin first");
    return false;
  }
  return true;
}

/* ================= PRODUCTS ================= */
function loadProducts() {
  fetch(API_URL)
    .then(res => res.json())
    .then(data => {
      products = data;
      renderProducts();

      productsReady = true;
      checkAppReady();
    });
}












  
function renderProducts() {
  const list = document.getElementById("productList");
  list.innerHTML = "";

  let dragIndex = null;

  products.forEach((p, i) => {
    const card = document.createElement("div");
    card.className = "card";
    if (openCards.has(p.row)) {
  card.classList.add("show");
}


    /* ===== SMART GRID DRAG SYSTEM ===== */
    if (adminUnlocked) {

      card.style.touchAction = "none"; // important for mobile

  card.addEventListener("pointerdown", (e) => {

  // ‚ùå Do NOT drag if clicking inside form elements
  if (
    e.target.closest("input") ||
    e.target.closest("textarea") ||
    e.target.closest("button") ||
    e.target.closest("label")
  ) {
    return;
  }

  dragIndex = i;
  card.classList.add("dragging");
  card.setPointerCapture(e.pointerId);
});


      card.addEventListener("pointermove", (e) => {
        if (dragIndex === null) return;

        const elementBelow = document.elementFromPoint(e.clientX, e.clientY);
        const targetCard = elementBelow?.closest(".card");

        if (!targetCard) return;

        const cards = Array.from(document.querySelectorAll(".card"));
        const overIndex = cards.indexOf(targetCard);

        if (overIndex !== -1 && overIndex !== dragIndex) {

          const draggedItem = products.splice(dragIndex, 1)[0];
          products.splice(overIndex, 0, draggedItem);

          dragIndex = overIndex;

          renderProducts();
        }
      });

      card.addEventListener("pointerup", () => {
        dragIndex = null;
        document.querySelectorAll(".card")
          .forEach(c => c.classList.remove("dragging"));
      });
    }
    /* ===== END DRAG SYSTEM ===== */


   card.innerHTML = `
  <img src="${p.image || ''}" id="preview-${i}">
  <div class="name">${p.name || ''}</div>
  <div class="info">
    ${adminUnlocked ? `
      <input value="${p.name || ''}" id="name-${i}" placeholder="Name">
      <textarea id="description-${i}" placeholder="Description">${p.description || ''}</textarea>

      <label>Image URL:</label>
      <input id="imageUrl-${i}" value="${p.image || ''}" placeholder="https://...">

      <label>Or Upload Image:</label>
      <input type="file" id="file-${i}" accept="image/*">

      <input value="${p.price || ''}" id="price-${i}" placeholder="Price">
      <input value="${p.stock || ''}" id="stock-${i}" placeholder="Stock">

      <button onclick="event.stopPropagation(); saveProduct(${i})">Save</button>
      <button onclick="event.stopPropagation(); deleteProduct(${i})">Delete</button>
    ` : `
      <p>${p.description || ''}</p>
      <p>‚Çπ ${p.price || ''}</p>
      <p>Stock: ${p.stock || ''}</p>
    `}
  </div>
`;


   card.addEventListener("click", (e) => {
  if (
    e.target.closest("input") ||
    e.target.closest("textarea") ||
    e.target.closest("button") ||
    e.target.closest("label")
  ) {
    return; // do nothing when editing
  }

 card.classList.toggle("show");

if (card.classList.contains("show")) {
  openCards.add(p.row);
} else {
  openCards.delete(p.row);
}

});


    list.appendChild(card);
  });
}









  



  



  window.saveProduct = async function(i) {
  if (!requireAdmin()) return;

  const fileInput = document.getElementById(`file-${i}`);
  const urlInput = document.getElementById(`imageUrl-${i}`);

  let image = products[i].image || "";

  // If URL entered
  if (urlInput && urlInput.value.trim() !== "") {
    image = urlInput.value.trim();
  }

  // If file selected ‚Üí convert to Base64
  if (fileInput && fileInput.files[0]) {
    image = await new Promise(resolve => {
      const reader = new FileReader();
      reader.onload = e => resolve(e.target.result);
      reader.readAsDataURL(fileInput.files[0]);
    });
  }

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "update",
      row: products[i].row,
      name: document.getElementById(`name-${i}`).value,
      description: document.getElementById(`description-${i}`).value,
      price: document.getElementById(`price-${i}`).value,
      stock: document.getElementById(`stock-${i}`).value,
      image: image
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
    
// Update local data instantly
products[i].name = document.getElementById(`name-${i}`).value;
products[i].description = document.getElementById(`description-${i}`).value;
products[i].price = document.getElementById(`price-${i}`).value;
products[i].stock = document.getElementById(`stock-${i}`).value;
products[i].image = image;

// Re-render instantly (preserves open cards)
renderProducts();

//

    } else {
      alert("Save failed ‚ùå");
    }
  });
};



  

window.deleteProduct = function(i) {
  if (!requireAdmin()) return;
  if (!confirm("Delete product?")) return;

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "delete", row: products[i].row })
  }).then(loadProducts);
};







    

const customModal = document.getElementById("customThemeModal");
const colorInput = document.getElementById("customColor");
const colorPreview = document.getElementById("colorPreview");
const saveBtn = document.getElementById("saveCustomThemeBtn");
const cancelBtn = document.getElementById("cancelCustomThemeBtn");

// Update preview in real time
colorInput.addEventListener("input", () => {
  colorPreview.style.background = colorInput.value;
});

// Save theme
saveBtn.addEventListener("click", () => {
  const color = colorInput.value;

  // Calculate brightness for text color
  const r = parseInt(color.substr(1,2),16);
  const g = parseInt(color.substr(3,2),16);
  const b = parseInt(color.substr(5,2),16);
  const brightness = (r*299 + g*587 + b*114)/1000;
  const textColor = brightness>128 ? "#000" : "#fff";

  document.body.classList.remove("night");
  document.body.style.background = color;
  document.body.style.color = textColor;

  localStorage.setItem("theme", "custom");
  localStorage.setItem("customColor", color);

  customModal.style.display = "none";
});

// Cancel button
cancelBtn.addEventListener("click", () => {
  customModal.style.display = "none";
});



  

  

document.getElementById("saveOrderBtn")
  ?.addEventListener("click", saveOrder);
  
document.getElementById("loginBtn").onclick = googleLogin;
document.getElementById("logoutBtn").onclick = logoutUser;
document.getElementById("adminUnlockBtn").onclick = unlockAdmin;
document.getElementById("adminOffBtn").onclick = logoutAdmin;
document.getElementById("addProductBtn").onclick = () => alert("Use sheet to add");





  /* ================= SCROLL VIDEO CONTROL ================= */

gsap.registerPlugin(ScrollTrigger);


  function initScrollVideo() {
  const video = document.getElementById("scrollVideo");
  if (!video) return;

  video.pause();
  video.muted = true;
  video.setAttribute("playsinline", "");
  video.setAttribute("webkit-playsinline", "");
  video.preload = "auto";

  const setupScroll = () => {
    const duration = video.duration;

    gsap.to(video, {
      currentTime: duration,
      ease: "none",
      scrollTrigger: {
        trigger: video.parentElement,
        start: "top top",
        end: "bottom bottom",
        scrub: true,
        invalidateOnRefresh: true
      }
    });
  };

  if (video.readyState >= 1) {
    setupScroll();
  } else {
    video.addEventListener("loadedmetadata", setupScroll);
  }
}


  
/* ===== SMART LOGIN TOOLTIP ===== */

let tooltipInterval;



// hide on click anywhere
  document.addEventListener("click", () => {
  const tooltip = document.getElementById("loginTooltip");
  if (tooltip) {
    tooltip.style.display = "none";
  }
});













/* ===== LOGIN GUIDE SYSTEM ===== */

const guide = document.getElementById("loginGuide");
const loginBtn = document.getElementById("loginBtn");
let guideInterval;

function positionGuide() {
  const rect = loginBtn.getBoundingClientRect();
  guide.style.top = (rect.top - 70) + "px";
  guide.style.left = (rect.left + rect.width / 2) + "px";
  guide.style.transform = "translateX(-50%)";
}

function showGuide() {
  if (!auth.currentUser) {
    positionGuide();if (guide)
    guide.style.display = "block";

    setTimeout(() => {if (guide) 
      guide.style.display = "none";
    }, 4000);
  }
}

function startGuide() {
  showGuide();

  guideInterval = setInterval(() => {
    if (!auth.currentUser) {
      showGuide();
    }
  }, 5000);
}

document.addEventListener("click", () => {if (guide)
  guide.style.display = "none";
});


window.addEventListener("scroll", () => {if (guide)
  guide.style.display = "none";
});




onAuthStateChanged(auth, (user) => {
  if (user) {
    clearInterval(guideInterval);
    guide.style.display = "none";
  } else {
    startGuide();
  }
});



</script>


<!-- LOGIN GUIDE POPUP -->
<div id="loginGuide" class="login-guide">
  Please login to continue your experience
  <div class="guide-arrow"></div>
</div>


</body>
</html>

