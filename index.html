
<!DOCTYPE html> 
<html>
<head>
  <link rel="icon" href="data:,">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Shop Herabete Admin v9.30.4</title>    <!-- ADDING LOGINFIRST SYTEM IF NOT LOGIN YOU CANT USE THE APP -->

  <style> 
    body {
      margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f5f6fa;
    }

    header {
      background: #111;
      color: white;
      padding: 18px;
      text-align: center;
      font-size: 20px;
      font-weight: 600;
    }

    #adminBar {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #222;
      color: white;
      padding: 10px;
      text-align: center;
      z-index: 9999;
    }

    #adminBar button {
      margin-left: 10px;
      padding: 5px 12px;
      border: none;
      border-radius: 6px;
      background: red;
      color: white;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      padding: 20px;
      margin-top: 10px;
    }

    .card {
      background: white;
      border-radius: 14px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      overflow: hidden;
      cursor: pointer;
    }

    .card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      background: #eee;
    }

    .card.dragging {
  opacity: 0.6;
}


    .name {
      font-weight: 600;
      padding: 8px;
      text-align: center;
    }

    .info {
      padding: 12px;
      display: none;
    }

    .card.show .info {
      display: block;
    }

    .info input,
    .info textarea,
    .info button {
      width: 100%;
      margin-top: 6px;
      padding: 6px;
    }



    /* ===== THEME SWITCH ===== */

    .theme-panel {
  display: flex;
  align-items: center;
  gap: 10px;
}

#themeSelect {
  padding: 6px 12px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
}

#customColor {
  width: 40px;
  height: 40px;
  border: none;
  cursor: pointer;
  border-radius: 50%;
  padding: 0;
}

    

.theme-switch {
  position: fixed;
  top: 80px;          /* move below admin bar */
  right: 20px;
  z-index: 10000;     /* higher than admin bar */
}


.theme-switch input {
  display: none;
}

.slider {
  width: 70px;
  height: 35px;
  background: #ddd;
  border-radius: 50px;
  position: relative;
  cursor: pointer;
  transition: background 0.4s ease;
  display: flex;
  align-items: center;
  padding: 0 5px;
}

.slider::before {
  content: "";
  position: absolute;
  width: 28px;
  height: 28px;
  background: white;
  border-radius: 50%;
  top: 3.5px;
  left: 4px;
  transition: transform 0.4s ease;
  box-shadow: 0 3px 8px rgba(0,0,0,0.2);
}

.icon {
  font-size: 14px;
  z-index: 2;
}

.sun {
  margin-left: auto;
}

input:checked + .slider {
  background: #222;
}

input:checked + .slider::before {
  transform: translateX(34px);
}
/* ===== NIGHT MODE FULL DARK ===== */

body {
  transition: background 0.4s ease, color 0.4s ease;
}

body.night {
  background: #0f172a !important;
  color: #ffffff !important;
}

/* Header */
body.night header {
  background: #020617 !important;
  color: #ffffff !important;
}

/* Admin bar */
body.night #adminBar {
  background: #111827 !important;
}

/* Login button */
body.night #loginBtn {
  background: #1e293b !important;
  color: white !important;
}

/* Cards */
body.night .card {
  background: #1e293b !important;
  color: #ffffff !important;
  box-shadow: 0 6px 18px rgba(0,0,0,0.6) !important;
}

/* Images */
body.night .card img {
  background: #0f172a !important;
}

/* Inputs & textarea */
body.night input,
body.night textarea {
  background: #0f172a !important;
  color: #ffffff !important;
  border: 1px solid #334155 !important;
}

/* Buttons */
body.night button {
  background: #334155 !important;
  color: #ffffff !important;
}
/* Modal overlay */
.theme-modal {
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10001;
}

/* Modal box */
.theme-modal-content {
  background: #fff;
  padding: 25px 30px;
  border-radius: 15px;
  width: 320px;
  text-align: center;
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
  display: flex;
  flex-direction: column;
  gap: 15px;
  animation: fadeIn 0.3s ease;
}

.theme-modal-content h3 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
}

/* Color picker + preview */
.color-picker-wrapper {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
}

#customColor {
  width: 60px;
  height: 60px;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  transition: transform 0.2s;
}

#customColor:hover {
  transform: scale(1.1);
}

#colorPreview {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: 2px solid #333;
  background: #ff0000;
}

/* Buttons */
.theme-buttons {
  display: flex;
  justify-content: space-between;
  gap: 10px;
}

.theme-buttons button {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: background 0.2s;
}

#saveCustomThemeBtn {
  background: #22c55e;
  color: white;
}

#saveCustomThemeBtn:hover {
  background: #16a34a;
}

#cancelCustomThemeBtn {
  background: #ef4444;
  color: white;
}

#cancelCustomThemeBtn:hover {
  background: #b91c1c;
}

/* Fade in */
@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.9);}
  to { opacity: 1; transform: scale(1);}
}
    
#loginOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #111;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 20000;
}

.login-box {
  background: white;
  padding: 40px;
  border-radius: 15px;
  text-align: center;
}

.login-box button {
  padding: 10px 20px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  background: #4285F4;
  color: white;
  cursor: pointer;
}


.spinner {
  width:40px;
  height:40px;
  border:4px solid rgba(255,255,255,0.2);
  border-top:4px solid white;
  border-radius:50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

    
    
  </style>
</head>























  
<body>

<header>My Shop Heeraa-betee</header>

<div id="userSection" style="display:none;">
  <img id="userPhoto" width="35" height="35" style="border-radius:50%;">
  <span id="userName"></span>
  <button id="logoutBtn">Logout</button>
</div>



  <div id="loginOverlay" style="display:none;">
  <div class="login-box">
    <h2>Welcome to My Shop</h2>
    <button id="loginBtn">Login with Google</button>
  </div>
</div>
  
<div id="authLoading" style="
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  color:white;
  font-size:20px;
  z-index:30000;
  flex-direction:column;
">
  <div class="spinner"></div>
  <div style="margin-top:15px;">Loading...</div>
</div>






  


  
<div id="adminBar">
  Admin Mode: <b>ON</b>
  <button id="adminOffBtn">OFF</button>
  <button id="addProductBtn">‚ûï Add Product</button>
  <button id="saveOrderBtn">üíæ Save Order</button>

</div>

<button id="adminUnlockBtn" style="display:none;">üîê Open Admin</button>






  
  <div class="theme-panel">
  <select id="themeSelect">
    <option value="day">‚òÄ Day</option>
    <option value="night">üåô Night</option>
    <option value="custom">üé® Custom</option>
  </select>


    
</div>






<div id="customThemeModal" class="theme-modal" style="display:none;">
  <div class="theme-modal-content">
    <h3>Choose Your Custom Theme</h3>

    <div class="color-picker-wrapper">
     <input type="color" id="customColor">
<div id="colorPreview"></div>
    </div>

    <div class="theme-buttons">
      <button id="saveCustomThemeBtn">üíæ Save Theme</button>
      <button id="cancelCustomThemeBtn">‚ùå Cancel</button>
    </div>
  </div>
</div>



  
  

  
<div class="grid" id="productList"></div>

<script type="module">

function closeThemeModal() {
  document.getElementById("customThemeModal").style.display = "none";
}
  
document.getElementById("saveCustomThemeBtn").addEventListener("click", () => {
  const color = document.getElementById("customColor").value;

  document.body.classList.remove("night");

  document.body.style.background = color;

  // auto text color
  const r = parseInt(color.substr(1,2),16);
  const g = parseInt(color.substr(3,2),16);
  const b = parseInt(color.substr(5,2),16);
  const brightness = (r * 299 + g * 587 + b * 114) / 1000;
  document.body.style.color = brightness > 128 ? "#000" : "#fff";

  localStorage.setItem("theme", "custom");
  localStorage.setItem("customColor", color);

  closeThemeModal();
});












window.addEventListener("DOMContentLoaded", () => {
  const select = document.getElementById("themeSelect");
  const customModal = document.getElementById("customThemeModal");
  const colorInput = document.getElementById("customColor");
  const colorPreview = document.getElementById("colorPreview");

  const savedTheme = localStorage.getItem("theme");
  const savedColor = localStorage.getItem("customColor");

  // Apply saved theme silently
  if (savedTheme === "night") {
    document.body.classList.add("night");
    select.value = "night";
  } else if (savedTheme === "custom" && savedColor) {
    document.body.classList.remove("night");
    document.body.style.background = savedColor;

    const r = parseInt(savedColor.substr(1,2),16);
    const g = parseInt(savedColor.substr(3,2),16);
    const b = parseInt(savedColor.substr(5,2),16);
    const brightness = (r*299 + g*587 + b*114)/1000;
    document.body.style.color = brightness > 128 ? "#000" : "#fff";

    colorInput.value = savedColor;
    colorPreview.style.background = savedColor;

    select.value = "custom"; // dropdown shows custom
    // DO NOT open modal
  } else {
    select.value = "day";
  }

  // Change event
  select.addEventListener("change", () => {
    const theme = select.value;

    if (theme === "day") {
      document.body.classList.remove("night");
      document.body.style.background = "";
      document.body.style.color = "";
      localStorage.setItem("theme", "day");
    } else if (theme === "night") {
      document.body.classList.add("night");
      document.body.style.background = "";
      document.body.style.color = "";
      localStorage.setItem("theme", "night");
    } else if (theme === "custom") {

  const savedColor = localStorage.getItem("customColor");

  if (savedColor) {
    colorInput.value = savedColor;
    colorPreview.style.background = savedColor;
  }

  customModal.style.display = "flex";
}
  });

  // Color preview in real-time
  colorInput.addEventListener("input", () => {
    colorPreview.style.background = colorInput.value;
  });

  // Save custom theme
  document.getElementById("saveCustomThemeBtn").addEventListener("click", () => {
    const color = colorInput.value;

    const r = parseInt(color.substr(1,2),16);
    const g = parseInt(color.substr(3,2),16);
    const b = parseInt(color.substr(5,2),16);
    const brightness = (r*299 + g*587 + b*114)/1000;

    document.body.classList.remove("night");
    document.body.style.background = color;
    document.body.style.color = brightness > 128 ? "#000" : "#fff";

    localStorage.setItem("theme", "custom");
    localStorage.setItem("customColor", color);

    customModal.style.display = "none";
  });

  // Cancel button
  document.getElementById("cancelCustomThemeBtn").addEventListener("click", () => {
    customModal.style.display = "none";
  });
});


  

  

  

  

/* ================= FIREBASE ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getAuth,
  GoogleAuthProvider,
  signInWithPopup,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCV432JfpHR3abZJXPDthNvH2jDMGLRcrM",
  authDomain: "my-shop-app-dc042.firebaseapp.com",
  projectId: "my-shop-app-dc042",
  storageBucket: "my-shop-app-dc042.firebasestorage.app",
  messagingSenderId: "393287049357",
  appId: "1:393287049357:web:1460ddf82ddad440e2c2c4"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

/* ================= CONFIG ================= */
const ADMIN_UID = "mOP5jc6j28b8SIvXEyskqCtsQZG3";
const API_URL = "https://script.google.com/macros/s/AKfycbwjXIv0nS29QPEbbEMjTqsLDhw2SV2ZojhCU2lvb8wdR4R57GwKeIxa8wR-ouLUX1bb/exec";

/* ================= STATE ================= */
let adminUnlocked = false;
let products = [];
  let openCards = new Set();
let authReady = false;
let productsReady = false;

/* ================= AUTH ================= */
function googleLogin() {
  signInWithPopup(auth, provider)
    .catch(err => alert(err.message));
}

function logoutUser() {
  signOut(auth);
}




  onAuthStateChanged(auth, (user) => {

  const overlay = document.getElementById("loginOverlay");

  adminUnlocked = false;
  document.getElementById("adminBar").style.display = "none";
  document.getElementById("adminUnlockBtn").style.display = "none";

  if (user) {
    
    overlay.style.display = "none";

    document.getElementById("userSection").style.display = "flex";
    document.getElementById("loginBtn").style.display = "none";
    document.getElementById("userPhoto").src = user.photoURL;
    document.getElementById("userName").textContent = user.displayName;

    if (user.uid === ADMIN_UID) {
      document.getElementById("adminUnlockBtn").style.display = "block";
    }

    // üå∏ FORCE Pink Theme For YUSRA
    const firstName = user.displayName
      ? user.displayName.trim().split(" ")[0].toUpperCase()
      : "";

    if (firstName === "YUSRA") {
      const pink = "#ff69b4";

      localStorage.setItem("theme", "custom");
      localStorage.setItem("customColor", pink);

      document.body.classList.remove("night");
      document.body.style.background = pink;

      const r = parseInt(pink.substr(1,2),16);
      const g = parseInt(pink.substr(3,2),16);
      const b = parseInt(pink.substr(5,2),16);
      const brightness = (r*299 + g*587 + b*114)/1000;

      document.body.style.color = brightness > 128 ? "#000" : "#fff";
    }

  } else {

    overlay.style.display = "flex";
    document.getElementById("userSection").style.display = "none";
    document.getElementById("loginBtn").style.display = "block";
  }

  // ‚úÖ IMPORTANT PART
  authReady = true;
  checkAppReady();

});


 loadProducts();





  
function checkAppReady() {
  if (authReady && productsReady) {
    document.getElementById("authLoading").style.display = "none";
  }
}




  


  

  function saveOrder() {
  if (!requireAdmin()) return;

  const orderData = products.map((p, index) => ({
    row: p.row,
    id: p.id,
    newPosition: index + 1
  }));

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "reorder",  token: idToken, 
      order: orderData
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      alert("Order saved permanently ‚úÖ");
    } else {
      alert("Failed to save order ‚ùå");
    }
  })
  .catch(err => {
    console.error("Save order error:", err);
    alert("Error saving order");
  });
}



  

/* ================= ADMIN ================= */
async function unlockAdmin() {
  const user = auth.currentUser;
  if (!user || user.uid !== ADMIN_UID) return alert("Not authorized");

  const password = prompt("Enter Admin Password");
  if (!password) return;

  const res = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "login", password })
  });

  const data = await res.json();
  if (data.success) {
    adminUnlocked = true;
    document.getElementById("adminBar").style.display = "block";
    document.getElementById("adminUnlockBtn").style.display = "none";
    renderProducts();
  } else {
    alert("Wrong password");
  }
}

function logoutAdmin() {
  adminUnlocked = false;
  document.getElementById("adminBar").style.display = "none";
  document.getElementById("adminUnlockBtn").style.display = "block";
  renderProducts();
}

function requireAdmin() {
  if (!adminUnlocked) {
    alert("Unlock admin first");
    return false;
  }
  return true;
}

/* ================= PRODUCTS ================= */
  function loadProducts() {
  fetch(API_URL)
    .then(res => res.json())
    .then(data => {

      products = data;

      // Render products first
      renderProducts();

      // Wait one frame so browser paints UI
      requestAnimationFrame(() => {

        productsReady = true;
        checkAppReady();

      });
    });
}












  
function renderProducts() {
  const list = document.getElementById("productList");
  list.innerHTML = "";

  let dragIndex = null;

  products.forEach((p, i) => {
    const card = document.createElement("div");
    card.className = "card";
    if (openCards.has(p.row)) {
  card.classList.add("show");
}


    /* ===== SMART GRID DRAG SYSTEM ===== */
    if (adminUnlocked) {

      card.style.touchAction = "none"; // important for mobile

  card.addEventListener("pointerdown", (e) => {

  // ‚ùå Do NOT drag if clicking inside form elements
  if (
    e.target.closest("input") ||
    e.target.closest("textarea") ||
    e.target.closest("button") ||
    e.target.closest("label")
  ) {
    return;
  }

  dragIndex = i;
  card.classList.add("dragging");
  card.setPointerCapture(e.pointerId);
});


      card.addEventListener("pointermove", (e) => {
        if (dragIndex === null) return;

        const elementBelow = document.elementFromPoint(e.clientX, e.clientY);
        const targetCard = elementBelow?.closest(".card");

        if (!targetCard) return;

        const cards = Array.from(document.querySelectorAll(".card"));
        const overIndex = cards.indexOf(targetCard);

        if (overIndex !== -1 && overIndex !== dragIndex) {

          const draggedItem = products.splice(dragIndex, 1)[0];
          products.splice(overIndex, 0, draggedItem);

          dragIndex = overIndex;

          renderProducts();
        }
      });

      card.addEventListener("pointerup", () => {
        dragIndex = null;
        document.querySelectorAll(".card")
          .forEach(c => c.classList.remove("dragging"));
      });
    }
    /* ===== END DRAG SYSTEM ===== */


   card.innerHTML = `
  <img src="${p.image || ''}" id="preview-${i}">
  <div class="name">${p.name || ''}</div>
  <div class="info">
    ${adminUnlocked ? `
      <input value="${p.name || ''}" id="name-${i}" placeholder="Name">
      <textarea id="description-${i}" placeholder="Description">${p.description || ''}</textarea>

      <label>Image URL:</label>
      <input id="imageUrl-${i}" value="${p.image || ''}" placeholder="https://...">

      <label>Or Upload Image:</label>
      <input type="file" id="file-${i}" accept="image/*">

      <input value="${p.price || ''}" id="price-${i}" placeholder="Price">
      <input value="${p.stock || ''}" id="stock-${i}" placeholder="Stock">

      <button onclick="event.stopPropagation(); saveProduct(${i})">Save</button>
      <button onclick="event.stopPropagation(); deleteProduct(${i})">Delete</button>
    ` : `
      <p>${p.description || ''}</p>
      <p>‚Çπ ${p.price || ''}</p>
      <p>Stock: ${p.stock || ''}</p>
    `}
  </div>
`;


   card.addEventListener("click", (e) => {
  if (
    e.target.closest("input") ||
    e.target.closest("textarea") ||
    e.target.closest("button") ||
    e.target.closest("label")
  ) {
    return; // do nothing when editing
  }

 card.classList.toggle("show");

if (card.classList.contains("show")) {
  openCards.add(p.row);
} else {
  openCards.delete(p.row);
}

});


    list.appendChild(card);
  });
}









  



  



  window.saveProduct = async function(i) {
  if (!requireAdmin()) return;

  const fileInput = document.getElementById(`file-${i}`);
  const urlInput = document.getElementById(`imageUrl-${i}`);

  let image = products[i].image || "";

  // If URL entered
  if (urlInput && urlInput.value.trim() !== "") {
    image = urlInput.value.trim();
  }

  // If file selected ‚Üí convert to Base64
  if (fileInput && fileInput.files[0]) {
    image = await new Promise(resolve => {
      const reader = new FileReader();
      reader.onload = e => resolve(e.target.result);
      reader.readAsDataURL(fileInput.files[0]);
    });
  }

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "update", token: idToken,
      row: products[i].row,
      name: document.getElementById(`name-${i}`).value,
      description: document.getElementById(`description-${i}`).value,
      price: document.getElementById(`price-${i}`).value,
      stock: document.getElementById(`stock-${i}`).value,
      image: image
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
    
// Update local data instantly
products[i].name = document.getElementById(`name-${i}`).value;
products[i].description = document.getElementById(`description-${i}`).value;
products[i].price = document.getElementById(`price-${i}`).value;
products[i].stock = document.getElementById(`stock-${i}`).value;
products[i].image = image;

// Re-render instantly (preserves open cards)
renderProducts();

//

    } else {
      alert("Save failed ‚ùå");
    }
  });
};



  window.deleteProduct = async function(i) {
  if (!requireAdmin()) return;
  if (!confirm("Delete product?")) return;

  const user = auth.currentUser;
  if (!user) return;

  const idToken = await user.getIdToken();

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "delete",
      row: products[i].row,
      token: idToken   // ‚Üê only this added
    })
  }).then(loadProducts);
};



  







    

const customModal = document.getElementById("customThemeModal");
const colorInput = document.getElementById("customColor");
const colorPreview = document.getElementById("colorPreview");
const saveBtn = document.getElementById("saveCustomThemeBtn");
const cancelBtn = document.getElementById("cancelCustomThemeBtn");

// Update preview in real time
colorInput.addEventListener("input", () => {
  colorPreview.style.background = colorInput.value;
});

// Save theme
saveBtn.addEventListener("click", () => {
  const color = colorInput.value;

  // Calculate brightness for text color
  const r = parseInt(color.substr(1,2),16);
  const g = parseInt(color.substr(3,2),16);
  const b = parseInt(color.substr(5,2),16);
  const brightness = (r*299 + g*587 + b*114)/1000;
  const textColor = brightness>128 ? "#000" : "#fff";

  document.body.classList.remove("night");
  document.body.style.background = color;
  document.body.style.color = textColor;

  localStorage.setItem("theme", "custom");
  localStorage.setItem("customColor", color);

  customModal.style.display = "none";
});

// Cancel button
cancelBtn.addEventListener("click", () => {
  customModal.style.display = "none";
});



  

  

document.getElementById("saveOrderBtn")
  ?.addEventListener("click", saveOrder);
  
document.getElementById("loginBtn").onclick = googleLogin;
document.getElementById("logoutBtn").onclick = logoutUser;
document.getElementById("adminUnlockBtn").onclick = unlockAdmin;
document.getElementById("adminOffBtn").onclick = logoutAdmin;
document.getElementById("addProductBtn").onclick = () => alert("Use sheet to add");
</script>



  
</body>
</html>
