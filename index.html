<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Shop Herabete G7</title>

<link rel="icon" href="data:,">

<style>
body {
  margin: 0;
  font-family: 'Segoe UI', Arial, sans-serif;
  background: #f5f6fa;
}
header {
  background: #111;
  color: white;
  padding: 18px;
  text-align: center;
  font-size: 20px;
  font-weight: 600;
}
#adminBar {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: #222;
  color: white;
  padding: 10px;
  text-align: center;
  z-index: 9999;
}
#adminBar button {
  margin-left: 10px;
  padding: 5px 12px;
  border: none;
  border-radius: 6px;
  background: red;
  color: white;
}
.grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
  padding: 15px;
  margin-top: 10px;
}
.card {
  background: white;
  border-radius: 14px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  overflow: hidden;
}
.card img {
  width: 100%;
  height: 170px;
  object-fit: cover;
  background: #eee;
}
.card .info {
  padding: 12px;
}
.card input,
.card textarea {
  width: 100%;
  margin-top: 6px;
  padding: 6px;
  border: 1px solid #ddd;
  border-radius: 6px;
}
.card button {
  width: 100%;
  margin-top: 8px;
  padding: 8px;
  border: none;
  border-radius: 8px;
  background: #111;
  color: white;
  font-weight: 600;
}
#adminBtn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  padding: 14px;
  border-radius: 50%;
  border: none;
  background: #111;
  color: white;
  font-size: 18px;
}
</style>
</head>

<body>

<header>My Shop Herabete G6</header>

<div id="adminBar">
  Admin Mode: <b>ON</b>
  <button onclick="logoutAdmin()">OFF</button>
</div>

<div class="grid" id="productList"></div>

<button id="adminBtn" onclick="openAdmin()">⚙️</button>

<script>



  
const API_URL = "https://script.googleusercontent.com/macros/echo?user_content_key=AY5xjrQ0PP4DaAqJuqNFbCusyv0K2Sp52RPzTl4ldv4LZ0BYyuG6MrlnUDSyuSh7iB-0ZHc985MivZTUojbbDBoS9nGWABHHKgA8osfo9mPnG4a4Unls7VfQNgNqYwcfhzh0dm5LWoUnlU9T9-EbEQHpWiHtvx-ysbmDJFrQnpAeaz03sAoCDHAnlVPBkkqR-CRrH22nLiMttnssX2pd--B8qxiak-t2a9dw3DD6kl0m9sj6qurzP1kW_9iJeNmxhLGJKRhDALo90PdpwidfpMaSwTCsIJA1Eg&lib=Mm5TD1Rsu1ku9GN4gS5A7AWbsYizgyvoY";



  
let adminMode = false;
let products = [];

/* ================= LOAD PRODUCTS ================= */

function loadProducts() {
  fetch(API_URL)
    .then(res => res.json())
    .then(data => {
      products = data;
      renderProducts();
    })
    .catch(err => {
      console.error("Load failed:", err);
      alert("Backend connection failed.");
    });
}

/* ================= ADMIN LOGIN ================= */

function openAdmin() {
  const pass = prompt("Enter Admin Password");
  if (!pass) return;

  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "text/plain" },
    body: JSON.stringify({
      action: "login",
      password: pass
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      adminMode = true;
      document.getElementById("adminBar").style.display = "block";
      document.getElementById("adminBtn").style.display = "none";
      renderProducts();
    } else {
      alert("Wrong password");
    }
  })
  .catch(err => {
    console.error(err);
    alert("Login failed.");
  });
}

function logoutAdmin() {
  adminMode = false;
  document.getElementById("adminBar").style.display = "none";
  document.getElementById("adminBtn").style.display = "block";
  renderProducts();
}

/* ================= RENDER PRODUCTS ================= */

function renderProducts() {
  const list = document.getElementById("productList");
  list.innerHTML = "";

  products.forEach((p, i) => {

    const card = document.createElement("div");
    card.className = "card";

    if (adminMode) {

      card.innerHTML = `
        <img src="${p.image || ''}">
        <div class="info">
          <input id="name-${i}" value="${p.name || ''}" placeholder="Name">
          <textarea id="description-${i}" placeholder="Description">${p.description || ''}</textarea>
          <input id="image-${i}" value="${p.image || ''}" placeholder="Image URL">
          <input id="stock-${i}" value="${p.stock || ''}" placeholder="Stock">
          <input id="price-${i}" value="${p.price || ''}" placeholder="Price">
          <button onclick="saveProduct(${i})">Save</button>
        </div>
      `;

    } else {

      card.innerHTML = `
        <img src="${p.image || ''}">
        <div class="info">
          <h3>${p.name}</h3>
          <p>${p.description}</p>
          <p><b>Stock:</b> ${p.stock}</p>
          <p><b>Price:</b> ${p.price}</p>
        </div>
      `;
    }

    list.appendChild(card);
  });
}

/* ================= SAVE PRODUCT ================= */

function saveProduct(i) {

  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "text/plain" },
    body: JSON.stringify({
      action: "update",
      row: products[i].row || i + 2,
      name: document.getElementById(`name-${i}`).value,
      description: document.getElementById(`description-${i}`).value,
      stock: document.getElementById(`stock-${i}`).value,
      price: document.getElementById(`price-${i}`).value,
      image: document.getElementById(`image-${i}`).value
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      alert("Saved!");
      loadProducts();
    } else {
      alert("Save error.");
    }
  })
  .catch(err => {
    console.error(err);
    alert("Save failed.");
  });
}

loadProducts();

</script>
</body>
</html>
